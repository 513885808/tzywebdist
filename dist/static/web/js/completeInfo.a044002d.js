webpackJsonp([16],{0:function(e,t,n){n(23),n(185);var o=window.$||n(46),r=(n(47),n(48),n(187)),a=o("[name=province]").val();r.init({provinceId:a,submitFormCallback:function(){r.subFunc.call(r)}})},185:function(e,t){},187:function(e,t,n){var o=window.$||n(46);n(64);var r=n(48),a=n(188),i=n(55),l=n(195),c=n(197),u=o("[name=province]").val(),s={init:function(e){this.options=e;o("#myInfoForm").validator({errorParent:".row",successCallback:function(t){var n=o(t.target).closest(".btn");e.submitFormCallback&&e.submitFormCallback(n,o("#myInfoForm"))},focusinCallback:function(){o(this);r.hideError(o(".errTxt"))},errorCallback:function(e){o(".errTxt");r.showError(o(".errTxt"))}}),this.bindEvt(),i.isModernBrower&&"9"!=i.isIE()?l.init():"9"!=i.isIE()&&"8"!=i.isIE()||c.init()},subFunc:function(e,t){var n=this,r=[{type:"name",url:"/profile/name",field:"userName"},{type:"sex",url:"/profile/sex",field:"sex"},{type:"highSchool",url:"/profile/school",field:"schoolId"},{type:"highYear",url:"/profile/school/year",field:"year"}],a=0;o.each(r,function(e,t){var i={};i[t.field]=o("[name="+t.type+"]").val(),"highSchool"==t.type&&(i[t.field]=o("[name="+t.type+"]").attr("code")),o.ajax({url:preServer+u+t.url,data:JSON.stringify(i),type:"post",success:function(e){if("string"==typeof e)var e=o.parseJSON(e);return 1!=e.code?void warn(e.msg):(a++,void(a==r.length&&n.subSuccessCallback()))}})})},subSuccessCallback:function(){warn("个人资料更新成功",function(){window.location="/user"})},bindEvt:function(){this.addSchool(),this.addYear()},addYear:function(){for(var e=(new Date).getFullYear(),t=[],n=0;n<5;n++)t.push(e--);var r=o("[name=highYearInput]").length?o("[name=highYearInput]").val():"",a=[];o.each(t,function(e,t){a.push("<option value="+t+">"+t+"</option>")}),o("[name=highYear]").empty().append('<option value="">请选择</option>'),o("[name=highYear]").append(a.join("")),r&&o("[name=highYear]").val(r)},addSchool:function(){var e=this.options;a.init({el:".addSchool",provinceId:e.provinceId,type:"highSchool",url:"/v2_1/client/"+u+"/highSchool/search",startCallback:function(e){e.find("h3 span").text("选择高中")},selectListCallback:function(e){o(".btn-close").trigger("click"),o(".addSchool").val(e.attr("name")),o(".addSchool").attr("code",e.attr("code")),o(".addSchool").closest(".row").removeClass("error empty")}})}};e.exports=s},195:function(e,t,n){var o=window.$||n(46),r=(n(196),o("[name=province]").val()),a=(n(55),{init:function(e){this.settings=e,this.bindEvt()},bindEvt:function(){var e=this;e.settings;if(o("#picker").length){var t=WebUploader.create({auto:!0,swf:"http://www.tzhiyuan.net/data/upload/swfupload.swf",server:preServer+r+"/attach/uploadAttach",chunked:!0,pick:{id:"#picker",innerHTML:"编辑图片"},resize:!1,accept:{title:"Images",extensions:"gif,jpg,jpeg,bmp,png",mimeTypes:"image/*"},formData:{avatar:""},fileVal:"avatar"});t.on("beforeFileQueued",function(e){}),t.on("fileQueued",function(e){}),t.on("uploadProgress",function(t,n){e.loadingStart()}),t.on("uploadSuccess",function(t,n){e.setAvatar(t,n)}),t.on("uploadError",function(e,t){console.log(t)}),t.on("uploadComplete",function(t){e.loadingStop()}),t.on("error",function(e){console.log(e)})}},loadingStart:function(){document.getElementById("loading").style.display="inline"},loadingStop:function(){document.getElementById("loading").style.display="none"},setAvatar:function(e,t){if("string"==typeof t)var t=o.parseJSON(t);return 1!=t.code?void warn(t.msg):void o.ajax({url:preServer+r+"/profile/avatar",type:"post",data:JSON.stringify({avatar:t.result.avatar}),success:function(e){if("string"==typeof e)var e=o.parseJSON(e);return 1!=e.code?void warn(e.msg):void warn("头像上传成功",function(){window.location.href="/user"})}})}});e.exports=a},196:function(e,t){"use strict";var n=Object.prototype.hasOwnProperty,o=Object.prototype.toString,r=Object.defineProperty,a=Object.getOwnPropertyDescriptor,i=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===o.call(e)},l=function(e){if(!e||"[object Object]"!==o.call(e))return!1;var t=n.call(e,"constructor"),r=e.constructor&&e.constructor.prototype&&n.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!t&&!r)return!1;var a;for(a in e);return"undefined"==typeof a||n.call(e,a)},c=function(e,t){r&&"__proto__"===t.name?r(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},u=function(e,t){if("__proto__"===t){if(!n.call(e,t))return;if(a)return a(e,t).value}return e[t]};e.exports=function s(){var e,t,n,o,r,a,p=arguments[0],f=1,d=arguments.length,v=!1;for("boolean"==typeof p&&(v=p,p=arguments[1]||{},f=2),(null==p||"object"!=typeof p&&"function"!=typeof p)&&(p={});f<d;++f)if(e=arguments[f],null!=e)for(t in e)n=u(p,t),o=u(e,t),p!==o&&(v&&o&&(l(o)||(r=i(o)))?(r?(r=!1,a=n&&i(n)?n:[]):a=n&&l(n)?n:{},c(p,{name:t,newValue:s(v,a,o)})):"undefined"!=typeof o&&c(p,{name:t,newValue:o}));return p}},197:function(e,t,n){var o=window.$||n(46),r=(n(196),o("[name=province]").val()),a={init:function(e){this.settings=e,this.bindEvt()},bindEvt:function(){function e(e,n){t.setAvatar(e,n)}var t=this;t.settings;if(o("#picker").length){var n={flash_url:"http://www.tzhiyuan.net/data/upload/swfupload.swf",upload_url:preServer+r+"/attach/uploadAttach",post_params:{avatar:""},file_post_name:"avatar",file_size_limit:"4 MB",file_types:"*.jpg;*.gif;*.png;*.jpeg;*.bmp",file_types_description:"img",custom_settings:{cancelButtonId:"btnCancel"},debug:!1,use_query_string:!0,button_image_url:"http://wacai-file.b0.upaiyun.com/assets/img/editAvatar.png",button_width:"82",button_height:"21",button_placeholder_id:"spanButtonPlaceHolder",button_action:SWFUpload.BUTTON_ACTION.SELECT_FILE,file_queued_handler:fileQueued,file_queue_error_handler:fileQueueError,file_dialog_complete_handler:fileDialogComplete,upload_error_handler:uploadError,upload_success_handler:uploadSuccess};swfu=new SWFUpload(n),window.froward=e}},setAvatar:function(e,t){if("string"==typeof t)var t=o.parseJSON(t);return 1!=t.code?void warn(t.msg):void o.ajax({url:preServer+r+"/profile/avatar",type:"post",data:JSON.stringify({avatar:t.result.avatar}),success:function(e){if("string"==typeof e)var e=o.parseJSON(e);return 1!=e.code?void warn(e.msg):void warn("头像上传成功",function(){window.location.href="/user"})}})}};e.exports=a}});